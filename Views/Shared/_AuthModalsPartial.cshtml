@* Views/Shared/_AuthModalsPartial.cshtml *@

<!-- Login Modal -->
<div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content login-modal">
            <div class="modal-header">
                <h5 class="modal-title" id="loginModalLabel">
                    <i class="fas fa-door-open me-2"></i> Đăng nhập
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="loginForm">
                    <div class="alert alert-danger" id="loginErrorMessage" style="display: none;"></div>
                    <div class="mb-3 form-group">
                        <label for="loginEmail" class="form-label"><i class="fas fa-envelope me-1"></i> Email</label>
                        <input type="email" class="form-control" id="loginEmail" placeholder="Nhập email của bạn" required>
                    </div>
                    <div class="mb-3 form-group">
                        <label for="loginPassword" class="form-label"><i class="fas fa-lock me-1"></i> Mật khẩu</label>
                        <input type="password" class="form-control" id="loginPassword" placeholder="Nhập mật khẩu" required>
                    </div>
                    <div class="mb-3 d-flex justify-content-between align-items-center">
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="rememberMe">
                            <label class="form-check-label" for="rememberMe">Ghi nhớ đăng nhập</label>
                        </div>
                        <a href="#" id="forgotPasswordLink" class="text-decoration-none">
                            <i class="fas fa-question-circle me-1"></i> Quên mật khẩu?
                        </a>
                    </div>
                    <button type="submit" class="btn btn-primary w-100 btn-login mb-3">
                        <i class="fas fa-arrow-right me-2"></i> Đăng nhập
                    </button>
                </form>
                <!-- Social login options -->
                @await Html.PartialAsync("_SocialLoginPartial")
            </div>
            <div class="modal-footer">
                <small class="text-muted">Chưa có tài khoản? <a href="#" data-bs-toggle="modal" data-bs-target="#registerModal" data-bs-dismiss="modal">Đăng ký ngay</a></small>
            </div>
        </div>
    </div>
</div>

<!-- Register Modal -->
<div class="modal fade" id="registerModal" tabindex="-1" aria-labelledby="registerModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content register-modal">
            <div class="modal-header">
                <h5 class="modal-title" id="registerModalLabel">
                    <i class="fas fa-user-check me-2"></i> Đăng ký
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="registerForm">
                    <div class="alert alert-danger" id="registerErrorMessage" style="display: none;"></div>
                    <div class="mb-3 form-group">
                        <label for="registerFullName" class="form-label"><i class="fas fa-user me-1"></i> Họ và tên</label>
                        <input type="text" class="form-control" id="registerFullName" placeholder="Nhập họ và tên" required>
                    </div>
                    <div class="mb-3 form-group">
                        <label for="registerEmail" class="form-label"><i class="fas fa-envelope me-1"></i> Email</label>
                        <input type="email" class="form-control" id="registerEmail" placeholder="Nhập email của bạn" required>
                    </div>
                    <div class="mb-3 form-group">
                        <label for="registerPassword" class="form-label"><i class="fas fa-lock me-1"></i> Mật khẩu</label>
                        <input type="password" class="form-control" id="registerPassword" placeholder="Tạo mật khẩu" required>
                    </div>
                    <div class="mb-3 form-group">
                        <label for="confirmPassword" class="form-label"><i class="fas fa-lock me-1"></i> Xác nhận mật khẩu</label>
                        <input type="password" class="form-control" id="confirmPassword" placeholder="Nhập lại mật khẩu" required>
                    </div>
                    <button type="submit" class="btn btn-primary w-100 btn-register mb-3">
                        <i class="fas fa-user-check me-2"></i> Đăng ký
                    </button>
                </form>
            </div>
            <div class="modal-footer">
                <small class="text-muted">Đã có tài khoản? <a href="#" data-bs-toggle="modal" data-bs-target="#loginModal" data-bs-dismiss="modal">Đăng nhập ngay</a></small>
            </div>
        </div>
    </div>
</div>

<!-- Email Verification Modal -->
<div class="modal fade" id="verificationModal" tabindex="-1" aria-labelledby="verificationModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content verification-modal">
            <div class="modal-header">
                <h5 class="modal-title" id="verificationModalLabel">
                    <i class="fas fa-envelope-open-text me-2"></i> Xác minh Email
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="text-center mb-4">
                    <div class="animate__animated animate__zoomIn">
                        <i class="fas fa-envelope-open-text fa-3x text-primary mb-3"></i>
                    </div>
                    <h4>Xác minh email của bạn</h4>
                    <p class="text-muted">Chúng tôi đã gửi một mã xác nhận đến email của bạn. Vui lòng kiểm tra hộp thư đến và nhập mã xác nhận dưới đây.</p>
                </div>

                <form id="verificationForm">
                    <div class="alert alert-danger" id="verificationErrorMessage" style="display: none;"></div>
                    <input type="hidden" id="verificationEmail" name="verificationEmail">

                    <div class="mb-4 form-group">
                        <label for="verificationCode" class="form-label">Mã xác nhận</label>
                        <input type="text" class="form-control form-control-lg text-center" id="verificationCode"
                               placeholder="000000" maxlength="6" required
                               style="letter-spacing: 5px; font-size: 24px; font-weight: bold;">
                    </div>

                    <button type="submit" class="btn btn-primary w-100 mb-3">
                        <i class="fas fa-check-circle me-2"></i> Xác nhận
                    </button>

                    <div class="d-flex justify-content-between align-items-center">
                        <div id="resendCounter" style="display: none;">
                            <small class="text-muted">Gửi lại sau <span id="countdownTimer">60</span>s</small>
                        </div>

                        <button type="button" id="resendVerificationBtn" class="btn btn-link text-decoration-none">
                            <small><i class="fas fa-redo me-1"></i> Gửi lại mã</small>
                        </button>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <small class="text-muted">Không nhận được email? Hãy kiểm tra thư mục spam/rác của bạn.</small>
            </div>
        </div>
    </div>
</div>

<!-- Success Modal -->
<div class="modal fade" id="successModal" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content success-modal">
            <div class="modal-header">
                <h5 class="modal-title" id="successModalLabel">
                    <i class="fas fa-check-circle me-2"></i> Thành công
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                <i class="fas fa-check-circle fa-4x text-success mb-3 animate__animated animate__bounceIn"></i>
                <h4 id="successMessage" class="fw-bold text-success mb-3" style="font-family: 'Poppins', sans-serif;"></h4>
                <p class="text-muted">Cảm ơn bạn đã sử dụng dịch vụ của chúng tôi!</p>
                <button type="button" class="btn btn-success btn-lg" data-bs-dismiss="modal">
                    <i class="fas fa-thumbs-up me-2"></i> Tuyệt vời!
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Change Password Modal -->
<div class="modal fade" id="changePasswordModal" tabindex="-1" aria-labelledby="changePasswordModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content change-password-modal">
            <div class="modal-header">
                <h5 class="modal-title modal-title-animated" id="changePasswordModalLabel">
                    <i class="fas fa-key me-2"></i> Đổi mật khẩu
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p class="text-muted mb-3">Để bảo mật tài khoản, vui lòng không chia sẻ mật khẩu với người khác.</p>
                <form id="changePasswordForm">
                    <div class="alert alert-danger" id="passwordErrorMessage" style="display: none;"></div>
                    <div class="mb-3 form-group">
                        <label for="currentPassword" class="form-label"><i class="fas fa-lock me-1"></i> Mật khẩu hiện tại</label>
                        <input type="password" class="form-control" id="currentPassword" placeholder="Nhập mật khẩu hiện tại" required>
                    </div>
                    <div class="mb-3 form-group">
                        <label for="newPassword" class="form-label"><i class="fas fa-key me-1"></i> Mật khẩu mới</label>
                        <input type="password" class="form-control" id="newPassword" placeholder="Nhập mật khẩu mới" required>
                    </div>
                    <div class="mb-3 form-group">
                        <label for="confirmNewPassword" class="form-label"><i class="fas fa-check me-1"></i> Xác nhận mật khẩu</label>
                        <input type="password" class="form-control" id="confirmNewPassword" placeholder="Nhập lại mật khẩu mới" required>
                    </div>
                    <div class="password-requirements mb-3">
                        <p class="text-muted"><small>Mật khẩu phải từ 6-8 ký tự, chứa ít nhất một chữ cái in hoa và một số.</small></p>
                    </div>
                    <button type="submit" class="btn btn-primary w-100">
                        <i class="fas fa-save me-2"></i> Cập nhật mật khẩu
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Forgot Password Modal with Multi-step Form -->
<div class="modal fade" id="forgotPasswordModal" tabindex="-1" aria-labelledby="forgotPasswordModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content register-modal">
            <div class="modal-header">
                <h5 class="modal-title modal-title-animated" id="forgotPasswordModalLabel">
                    <i class="fas fa-key me-2"></i> Khôi phục mật khẩu
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="forgotPasswordSteps">
                    <!-- Step 1: Email Entry -->
                    <div id="step1" class="step-content">
                        <p class="text-muted mb-3">Vui lòng nhập email đã đăng ký để nhận mã xác minh khôi phục mật khẩu.</p>
                        <form id="forgotPasswordForm" onsubmit="return false;">
                            <div class="alert alert-danger" id="forgotPasswordErrorMessage" style="display: none;"></div>
                            <div class="alert alert-success" id="forgotPasswordSuccessMessage" style="display: none;"></div>
                            <div class="mb-3 form-group">
                                <label for="forgotPasswordEmail" class="form-label">
                                    <i class="fas fa-envelope me-1"></i> Email
                                </label>
                                <input type="email" class="form-control" id="forgotPasswordEmail"
                                       placeholder="Nhập email đã đăng ký" required>
                                <small id="emailHelpBlock" class="form-text text-muted">
                                    Email phải đã được đăng ký trước đó trong hệ thống.
                                </small>
                            </div>
                            <button type="submit" class="btn btn-primary w-100">
                                <i class="fas fa-paper-plane me-2"></i> Tiếp tục
                            </button>
                        </form>
                    </div>

                    <!-- Step 2: Verification Code -->
                    <div id="step2" class="step-content" style="display: none;">
                        <div class="text-center mb-4">
                            <div class="animate__animated animate__zoomIn">
                                <i class="fas fa-envelope-open-text fa-3x text-primary mb-3"></i>
                            </div>
                            <h4>Xác minh email của bạn</h4>
                            <p class="text-muted">Chúng tôi đã gửi mã xác nhận đến email <strong id="confirmationEmail"></strong>. Vui lòng kiểm tra hộp thư đến và nhập mã xác nhận dưới đây.</p>
                        </div>

                        <div class="form-group verification-code-group">
                            <label for="verificationCode" class="form-label">Mã xác nhận</label>
                            <input type="text" class="form-control form-control-lg text-center" id="verificationCode"
                                   placeholder="000000" maxlength="6"
                                   style="letter-spacing: 5px; font-size: 24px; font-weight: bold;">
                        </div>

                        <div class="alert alert-danger" id="verificationErrorMessage" style="display: none;"></div>

                        <button type="button" class="btn btn-primary w-100 mb-3" id="verifyCodeBtn">
                            <i class="fas fa-check-circle me-2"></i> Xác nhận
                        </button>

                        <div class="d-flex justify-content-between align-items-center">
                            <div id="resendCounter" style="display: none;">
                                <small class="text-muted">Gửi lại sau <span class="countdown-timer">60</span>s</small>
                            </div>

                            <button type="button" class="btn btn-link p-0 resend-code-btn text-decoration-none">
                                <small><i class="fas fa-redo me-1"></i> Gửi lại mã</small>
                            </button>
                        </div>

                        <div class="mt-3 text-center">
                            <small class="text-muted">Không nhận được email? Hãy kiểm tra thư mục spam/rác của bạn.</small>
                        </div>
                    </div>

                    <!-- Step 3: New Password -->
                    <div id="step3" class="step-content" style="display: none;">
                        <div class="text-center mb-4">
                            <div class="animate__animated animate__zoomIn">
                                <i class="fas fa-lock-open fa-3x text-primary mb-3"></i>
                            </div>
                            <h4>Tạo mật khẩu mới</h4>
                            <p class="text-muted">Vui lòng nhập mật khẩu mới cho tài khoản của bạn.</p>
                        </div>

                        <div class="form-group mb-3">
                            <label for="newPassword" class="form-label">
                                <i class="fas fa-lock me-1"></i> Mật khẩu mới
                            </label>
                            <input type="password" class="form-control" id="newPassword" placeholder="Mật khẩu mới">
                            <small class="form-text text-muted">Mật khẩu phải từ 6-8 ký tự, chứa ít nhất một chữ cái in hoa và một số</small>
                        </div>

                        <div class="form-group mb-3">
                            <label for="confirmPassword" class="form-label">
                                <i class="fas fa-check me-1"></i> Xác nhận mật khẩu
                            </label>
                            <input type="password" class="form-control" id="confirmPassword" placeholder="Xác nhận mật khẩu">
                        </div>

                        <div class="alert alert-danger" id="passwordResetErrorMessage" style="display: none;"></div>

                        <button type="button" class="btn btn-primary w-100" id="resetPasswordBtn">
                            <i class="fas fa-save me-2"></i> Đặt lại mật khẩu
                        </button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <small class="text-muted">
                    Đã nhớ mật khẩu?
                    <a href="#" data-bs-toggle="modal" data-bs-target="#loginModal" data-bs-dismiss="modal">
                        Đăng nhập ngay
                    </a>
                </small>
            </div>
        </div>
    </div>
</div>

<!-- Session Modal -->
<div class="modal fade" id="sessionExpiredModal" tabindex="-1" aria-labelledby="sessionExpiredModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="sessionExpiredModalLabel">
                    <i class="fas fa-exclamation-circle me-2"></i>
                    <span class="session-modal-title">Phiên đăng nhập hết hạn</span>
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center py-4">
                <div class="session-icon">
                    <i class="fas fa-clock text-danger fa-3x mb-3"></i>
                </div>
                <h5 class="session-title fw-bold mb-3">Phiên đăng nhập đã hết hạn</h5>
                <p class="session-message mb-0">
                    Vui lòng đăng nhập lại để tiếp tục sử dụng hệ thống.
                </p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-1"></i> Đóng
                </button>
                <button type="button" class="btn btn-primary" id="sessionLoginBtn">
                    <i class="fas fa-sign-in-alt me-1"></i> Đăng nhập lại
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Debug Modal -->
<div class="modal fade" id="debugModal" tabindex="-1" aria-labelledby="debugModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="debugModalLabel">
                    <i class="fas fa-bug me-2"></i> Debug Information
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="debugContent" class="p-3 bg-light">
                    <div>Đang tải thông tin debug...</div>
                </div>
            </div>
        </div>
    </div>
</div>
